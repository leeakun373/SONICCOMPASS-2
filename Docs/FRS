Sonic Compass 2.0 功能需求规格说明书 (FRS)
版本: v2.2 (UCS & Gravity Mode Update)
日期: 2025-01-10
核心理念: Google Earth for Audio —— 从宏观语义宇宙到微观资产管理的无缝流转。

================================================================================
1. UCS模式 (UCS Mode) - 基于分类体系的可视化探索
================================================================================

核心逻辑: 基于82个UCS大类的硬性分类地图，强调类别边界和层次结构。

1.1 地图架构 (Map Architecture)

1.1.1 大类板块 (Main Category Continents)
布局原则:
- 基于82个UCS主类别，每个大类形成一个"大陆板块"
- 理想状态: 板块之间相连，形成无缝的世界地图
- 可接受状态: 板块之间有间隙（开发难度考虑），但**大陆内部必须紧密相连**
- 通过超级锚点策略（向量注入）强制同大类数据聚集

技术要求:
- 使用监督UMAP + 类别向量注入（category_weight=150.0）强制聚合
- min_dist=0.1 提供适当的"呼吸空间"，防止过度重叠
- 确保同一大类下的所有子类（如ANMLMisc, ANMLWcat等）都在同一大陆范围内

1.1.2 LOD层级 (Level of Detail)

LOD 0 (宏观 - 大陆视图):
- 显示: 仅六边形蜂窝网格（Hexbin）
- 颜色: 主类别颜色填充（淡色）+ 主类别颜色描边（实色）
- 标签: 显示主类别名称（Category），如"ANIMALS", "WEAPONS", "VEHICLES"
- 布局: 82个大类形成不同的"大陆板块"，尽量相连
- 交互: 点击大陆 -> 缩放到该大陆，进入LOD 1

LOD 1 (中观 - 子类视图):
- 显示: 六边形网格 
- 标签: 主类别标签消失，显示**CatID**（子类标识符），如"ANMLAqua", "ANMLDog", "ANMLWcat"
- 布局: 每个CatID归属其主类别"大陆"，显示在该大陆内部
- Hexbin生成: 基于该大陆内的数据分布生成蜂窝网格
- 要求: 尽量不要有重叠（通过hexbin算法和min_dist参数控制）

LOD 2 (微观 - 数据分布):
- 显示: 数据点（Points）清晰可见，六边形淡化为背景参考
- 边界: 即使微观视角，大陆边界的"幽灵边框"依然可见，提供区域上下文
- 细节: 显示具体的音频文件点，用户可以看到数据在大陆内的分布模式

1.2 搜索与高亮 (Search & Highlight)

1.2.1 传统搜索引擎
搜索栏功能:
- 基于文件metadata的传统搜索（文件名、路径、关键词、描述等）
- **不依赖AI语义搜索**，使用标准数据库查询（LIKE, IN等）
- 快速响应（< 200ms）

搜索结果高亮:
- 相关结果的Hexbin放大（视觉强调）
- 地图上的匹配项高亮显示（颜色/亮度变化）
- 右侧文件栏自动显示所有搜索结果列表
- 用户可以通过列表项定位到地图上的对应位置

1.2.2 Hexbin交互
点击Hexbin:
- 右侧文件栏直接显示该Hexbin内的所有文件数据
- 支持排序、筛选、预览等操作
- 可以进一步缩放到Hexbin内部，查看详细分布

1.3 视觉规范

蜂窝构造 (Hex Construction):
- 硬朗切割: 蜂窝单元之间保留明显间隙（5-10%或固定2px间距）
- 黑色切割线: 间隙处透出深色背景 (#0B0C0E)
- 玻璃边缘: 1px高亮描边（比填充色亮20%）
- 微弱渐变: 径向渐变填充（中心40%不透明度，边缘10%），增强立体感

================================================================================
2. Gravity模式 (Gravity Mode) - AI驱动的语义探索
================================================================================

核心逻辑: **完全无监督的UMAP自然分布**，通过AI语义理解和用户意图动态重排。

2.1 自然分布地图 (Natural Distribution Map)

2.1.1 初始状态
- 禁用监督学习（无target_weight，无类别向量注入）
- 基于纯音频特征的UMAP降维（1024维向量）
- 显示自然的语义相似度分布（声音相似的声音聚集）
- Hexbin跟随数据点分布生成（不是基于分类）

2.1.2 引力标签系统 (Gravity Label System)

搜索触发:
- 用户在搜索栏输入关键词或短语（如"Sci-Fi Gun", "Dark Ambient"）
- AI使用BGE-M3模型理解用户意图，生成语义向量
- 地图中心插入一个"引力标签"（Gravity Label）

动态重排:
- 地图上的所有点根据与引力标签的**语义相似度**重排
- 相似度高的点靠近引力中心（螺旋状排列）
- 相似度低的点远离中心，但保持相对位置关系
- 重排过程有平滑动画过渡

2.2 动态轴系统 (Dynamic Axes System)

2.2.1 用户自定义轴
功能位置: 左侧栏开启 "Dynamic Axes" 选项
交互:
- 用户可以设定X轴和Y轴（如 X="Organic", Y="Pitch"）
- AI分析当前数据集特征，提取对应维度的语义信息
- **XY轴定义可以干预UMAP分布**（重新计算或调整坐标）
- 地图上的点根据新轴重新排列

技术可行性:
- 可以通过多维度语义分析提取特征维度
- 使用PCA或因子分析确定"Organic"、"Pitch"等概念对应的向量方向
- 投影或重新计算UMAP坐标，实现轴的干预

2.2.2 AI自动建议 (Auto-Suggest)
智能推荐:
- 用户点击 "✨" 按钮
- AI分析当前视图中的数据分布特征
- 自动推荐区分度最大的XY轴配置
- 用户可以接受、修改或手动输入

示例:
- 如果当前数据主要是动物声音，AI可能建议 X="Aggressive/Calm", Y="High/Low Pitch"
- 用户也可以输入自然语言描述，AI解析为轴定义

2.3 视觉表现

引力螺旋 (Gravity Spiral):
- 无关项隐退: 非匹配项亮度降低80%
- 中心螺旋: Top 50-100匹配项以对数螺旋排列在屏幕中心
- 越中心匹配度越高，颜色/大小强化
- 保持背景地图作为参考上下文

================================================================================
3. 预设模式 (Preset Mode) - 自定义分类体系
================================================================================

核心逻辑: 基于用户和厂家自定义的分类规则，类似UCS但完全自定义。

3.1 预设系统架构

3.1.1 预设定义
数据格式: 参考 `presets.json` 文件
结构:
- 每个预设包含多个关键词/语义标签
- 预设映射到"大陆"（自定义类别）
- 示例: "Magic Mode" -> ["magic", "spell", "enchantment", "mystical"]
- 示例: "Cyberpunk Mode" -> ["futuristic", "digital", "tech", "neon", "synth"]

3.1.2 引力桩 (Gravity Pillars)
表现:
- 每个预设对应一个"引力桩"图标
- 地图上出现多个引力桩（如Magic、Cyberpunk、Horror等）
- 相关声音根据语义相似度吸附至对应桩周围
- 形成类似UCS模式的"大陆"结构，但完全基于语义而非硬性分类

3.2 用户自定义

3.2.1 创建预设
交互:
- 用户可以通过搜索和选择创建新预设
- 输入预设名称和关键词列表
- 可以手动添加或通过AI扩词辅助

3.2.2 AI扩词辅助
功能:
- 用户输入核心词（如"Scary"）
- AI基于BGE-M3模型推荐近义词和相关词
- 用户勾选添加到预设（如"Horror", "Creepy", "Eerie", "Terrifying"）
- 提高预设的覆盖面和准确性

3.3 模式切换

切换方式:
- 顶部模式切换器: UCS / Gravity / Preset / Library
- 预设模式下，用户可以选择激活的预设（可多选）
- 地图根据激活的预设动态重排

================================================================================
4. 库预览模式 (Library Preview Mode) - 文件系统可视化
================================================================================

核心逻辑: **完全无AI参与**，纯粹基于本地文件夹层级的可视化浏览。

4.1 层级结构

4.1.1 LOD层级映射
映射关系:
- LOD 0 (根目录): 显示顶级库/根目录（如"Boom Library", "Epic Stock"）
- LOD 1 (一级文件夹): 显示子文件夹（如"Mechanicals", "Nature Essentials"）
- LOD 2 (二级文件夹): 显示具体的末端文件夹
- LOD 3 (文件级): 显示音频文件点

4.1.2 布局算法
实现方式:
- 使用 Circle Packing (圆形打包) 或 Treemap (矩形树图) 算法
- 确保层级互不重叠，严格遵循硬盘目录结构
- 每个层级形成独立的"岛屿"或"板块"

4.2 可视化表现

4.2.1 Hexbin替代列表
- 将传统的文件夹列表转换为Hexbin可视化
- 每个文件夹/库对应一个或多个Hexbin
- 通过大小、颜色、密度反映文件夹内容量

4.2.2 交互
- 点击文件夹Hexbin -> 进入该文件夹，显示子文件夹/文件
- 支持面包屑导航（Breadcrumb）
- 用户可以快速定位到具体的库或文件夹

4.3 用途

适用场景:
- 快速浏览本地音频库结构
- 基于"肌肉记忆"的查找（用户知道文件在哪个文件夹）
- 不依赖AI或语义理解，纯粹的文件系统导航

================================================================================
5. 通用交互功能 (Common Interactions)
================================================================================

5.1 导航与操作

5.1.1 视图导航
- 滚轮缩放: 鼠标中心的缩放（Mouse-centered Zoom）
- 平移: 右键/中键拖拽平移
- 平滑动画: 所有缩放和平移都有平滑过渡

5.1.2 选择操作
框选 (Marquee Select):
- 右键拖拽画框
- 选中框内所有Hexbin/点
- 高亮显示选中项
- 结果投射到右侧文件栏列表

多选:
- 支持 Ctrl/Cmd + Click 累加选择多个Hexbin
- 支持 Shift + Click 区域选择

5.2 检查器面板 (Inspector Panel)

位置: 右侧固定面板（Width: 300px）

Tab 1: Info (信息)
- 显示大图波形
- 文件名、路径、格式
- UCS分类信息
- 其他元数据（只读）

Tab 2: Edit (修正)
- Universal Tagger 核心区域
- 核心滑块: Reality, Tone, Function (One-shot/Loop)
- **物理反馈**: 拖动滑块时，地图上的点位置即时偏移
- 修正数据写入本地数据库（不破坏原始Soundminer数据库）

Tab 3: AI (助手)
- 自然语言对话框
- 示例: "Show me more sounds like this but heavier"
- AI基于当前选中文件推荐相似文件

5.3 资产桥接 (Asset Bridge)

5.3.1 双向联动列表
位置: 可折叠的底部或侧边面板（List View）

Map -> List:
- 地图上框选/点选 -> 列表显示选中项
- 支持排序、筛选、搜索

List -> Map:
- 鼠标悬停列表项 -> 地图镜头平滑移动到该点并高亮
- 点击列表项 -> 地图缩放到该文件位置

5.3.2 音频引擎
驱动支持:
- ASIO (Windows)
- CoreAudio (Mac)
- 用户可在设置中选择输出设备（防止独占）

预览功能:
- 列表项包含迷你波形显示
- Space键播放/暂停
- 支持波形Scrubbing（拖拽进度条）

5.3.3 拖拽与导出
源:
- 从列表项拖拽
- 直接从地图上的点拖拽

目标:
- 直接拖入DAW（Reaper, Nuendo, Pro Tools）的轨道
- 拖入系统文件夹

状态栏:
- 底部显示 "Selected: [N] items | Total Size: [MB] | Duration: [MM:SS]"

================================================================================
6. 模式切换架构 (Mode Switching Architecture)
================================================================================

6.1 模式标识

顶部切换器:
- UCS模式: 基于82大类硬性分类
- Gravity模式: AI语义探索，无监督UMAP
- Preset模式: 用户自定义分类体系
- Library模式: 文件系统可视化

6.2 状态保持

切换行为:
- 每个模式独立维护视图状态（缩放级别、中心位置、选择状态）
- 切换模式时保存当前状态
- 切换回原模式时恢复状态

6.3 数据同步

- 文件列表在所有模式下共享
- Inspector面板内容根据当前模式调整
- 搜索功能根据模式使用不同策略（UCS用传统搜索，Gravity用AI搜索）

================================================================================
附录：非功能性需求 (NFR)
================================================================================

性能目标:
- 支持200万+音频资产索引
- 视图缩放帧率保持60 FPS（基于OpenGL/QPainter批量渲染）
- 搜索响应时间 < 200ms
- UMAP计算支持增量更新（新增文件时只计算新点）

视觉风格:
- 主题: Dark Cyberpunk（深灰背景 #0B0C0E, 霓虹点缀）
- 蜂窝: 必须有间隙（Gap）和渐变填充，避免色块化
- 动画: 所有交互都有平滑过渡（300ms缓动）

数据安全:
- 用户的"修正数据"（Tagger User Data）需独立存储
- 不破坏原始Soundminer数据库
- 支持数据备份和恢复

技术架构:
- 向量缓存: 支持增量更新，避免重复计算
- UMAP参数: 统一配置管理（core/umap_config.py）
- 超级锚点策略: 用于UCS模式的强制聚类（category_weight=150.0）
